import{j as e,m as D,a as b,b as I,c as O}from"./index-p70N3y1-.js";import{b as u,C as T,P as k,M,l as g,u as B,F as S,c as P,Z,d as z}from"./mapping-sgI7UULK.js";import{c as f,d as U,e as W,i as A,T as H}from"./data-BRLygxHr.js";import{g as L}from"./maplibre-C-0cvZmQ.js";import"./buildings-G9gdEBIE.js";const V=({header:n,children:r,expanded:c})=>{const[o,l]=u.useState(c??!1);return e.jsxs("div",{className:`collapsible${o?"":" collapsed"}`,children:[e.jsx("h2",{className:"collapsible-header",onClick:()=>l(!o),children:n}),e.jsx("div",{className:"collapsible-content",children:r})]})};var w,R;function $(){if(R)return w;R=1;var n=function(s){return s instanceof RegExp},r=function(t){var i=/[\\^$.*+?()[\]{}|]/g,a=RegExp(i.source);return t&&a.test(t)?t.replace(i,"\\$&"):t},c=function(s){return typeof s=="string"},o=function(s){var t=[];return s.forEach(function(i){Array.isArray(i)?t=t.concat(i):t.push(i)}),t};function l(s,t,i){var a=0,d=0;if(s==="")return s;if(!s||!c(s))throw new TypeError("First argument to react-string-replace#replaceString must be a string");var h=t;n(h)||(h=new RegExp("("+r(h)+")","gi"));for(var m=s.split(h),p=1,j=m.length;p<j;p+=2){if(m[p]===void 0||m[p-1]===void 0){console.warn("reactStringReplace: Encountered undefined value during string replacement. Your RegExp may not be working the way you expect.");continue}d=m[p].length,a+=m[p-1].length,m[p]=i(m[p],p,a),a+=d}return m}return w=function(t,i,a){return Array.isArray(t)||(t=[t]),o(t.map(function(d){return c(d)?l(d,i,a):d}))},w}var _=$();const q=L(_),x=({data:n,style:r})=>q(n,/([\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Connector_Punctuation}\p{Join_Control}]+\s?<\d+>)/gu,o=>{const[l,s]=o.replace(">","").split("<").map(i=>i.trim());console.log(o,l,s);const t=D.find(i=>i.id===s);return e.jsx("span",{style:r,...t?{className:"has-tooltip",title:t.definition}:{},children:l})}),E=({data:n})=>e.jsx("sup",{className:"has-tooltip",title:n.map(r=>r.title).join("; "),children:n.map(r=>r.number).join(",")}),F=({data:n})=>e.jsx(V,{header:"Історія",children:e.jsx("ul",{children:n.map((r,c)=>e.jsxs("li",{children:[r.date&&e.jsx("span",{style:{fontWeight:"bold",fontStyle:"italic"},children:r.date}),r.date&&r.description&&" — ",e.jsxs("span",{style:{whiteSpace:"pre-wrap"},children:[e.jsx(x,{data:r.description}),r.sources&&e.jsx(E,{data:r.sources})]})]},c))})}),y=({text:n,onClick:r})=>e.jsx("sup",{role:"button",onClick:r,style:{color:"var(--color-link)"},children:n});function Q({data:n,markerSize:r,onClick:c}){const[o,l]=u.useState(!1),[s,t]=u.useState(!1),i=n.period?.color??f.unknown;return n.coordinates?e.jsx(T,{center:n.coordinates,radius:r/2,color:f.overlay,opacity:.5,fillColor:i,fillOpacity:1,stroke:!0,weight:1,eventHandlers:{click:a=>{c(),a.target.openPopup(n.coordinates)}},children:e.jsxs(k,{className:"marker-popup",autoPan:!1,children:[e.jsxs("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:[e.jsx(x,{data:n.name,style:{fontWeight:"bold",fontSize:"1rem"}}),e.jsx("span",{style:{fontSize:"0.9rem"},children:n.date}),n.oldNames&&e.jsx("div",{style:o?{display:"none"}:{},children:e.jsx(y,{text:"давні назви",onClick:()=>l(!0)})}),n.oldNames&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"newline",style:{flexDirection:"column",alignItems:"center",textAlign:"center",display:o?"flex":"none"},children:n.oldNames.map((a,d)=>e.jsx("div",{style:{textAlign:"center"},children:a},d))}),e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}})]}),e.jsx("span",{style:{fontStyle:"italic"},children:n.address}),n.oldStreetNames&&e.jsx("div",{style:s?{display:"none"}:{},children:e.jsx(y,{text:"давні назви вулиці",onClick:()=>t(!0)})}),n.oldStreetNames&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"newline",style:{flexDirection:"column",alignItems:"center",textAlign:"center",display:s?"flex":"none"},children:n.oldStreetNames.map((a,d)=>e.jsx("div",{style:{textAlign:"center"},children:a},d))})})]}),n.description&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx(x,{data:n.description,style:{textAlign:"center"}})]}),n.architecture&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:e.jsxs("span",{children:["Архітектурний стиль: ",e.jsx(x,{data:n.architecture,style:{fontStyle:"italic"}})]})})]}),n.history&&e.jsx(F,{data:n.history})]})}):e.jsx(e.Fragment,{})}function Y({data:n,markerSize:r,onClick:c}){const[o,l]=u.useState(!1),s=n.period?.color??f.unknown;return n.coordinates?e.jsx(M,{position:n.coordinates,eventHandlers:{click:t=>{c(),t.target.openPopup(n.coordinates)}},icon:new g.DivIcon({className:"marker",iconSize:[r,r],iconAnchor:[r/2,r],html:U(r,s)}),children:e.jsxs(k,{className:"marker-popup",autoPan:!1,children:[e.jsxs("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:[e.jsx(x,{data:n.name,style:{fontWeight:"bold",fontSize:"1rem"}}),e.jsxs("span",{style:{fontSize:"0.9rem"},children:[n.date,n.destroyed?`—${n.destroyed}`:""]}),n.oldNames&&e.jsx("div",{style:o?{display:"none"}:{},children:e.jsx(y,{text:"давні назви",onClick:()=>l(!0)})}),n.oldNames&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"newline",style:{flexDirection:"column",alignItems:"center",textAlign:"center",display:o?"flex":"none"},children:n.oldNames.map((t,i)=>e.jsx("div",{style:{textAlign:"center"},children:t},i))})})]}),n.history&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsxs("div",{style:{whiteSpace:"pre-wrap"},children:[e.jsx(x,{data:n.history}),n.sources&&e.jsx(E,{data:n.sources})]})]})]})}):e.jsx(e.Fragment,{})}function N(n,r){if(!r.searchTerm||r.searchTerm.length<2)return!1;const c=r.searchTerm.toUpperCase();return Object.values(n).filter(o=>{if(typeof o=="string")return o.toUpperCase().includes(c);if(typeof o=="number")return o.toString().includes(c);if(Array.isArray(o))return o.filter(l=>typeof l=="string"?l.toUpperCase().includes(c):typeof l=="object"&&"description"in l?l.description.toUpperCase().includes(c):!1).length>0}).length>0}function G({data:n,markerSize:r,onClick:c}){const[o,l]=u.useState(!1),s=n.periodOfDestruction?.color??f.unknown;return n.coordinates?e.jsx(M,{position:n.coordinates,eventHandlers:{click:t=>{c(),t.target.openPopup(n.coordinates)}},icon:new g.DivIcon({className:"marker",iconSize:[r,r],iconAnchor:[r/2,r],html:W(r,s,!0)}),children:e.jsxs(k,{className:"marker-popup",autoPan:!1,children:[e.jsxs("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:[e.jsx(x,{data:n.name,style:{fontWeight:"bold",fontSize:"1rem"}}),e.jsxs("span",{style:{fontSize:"0.9rem"},children:[n.date,"—",n.destroyed]}),n.oldNames&&e.jsx("div",{style:o?{display:"none"}:{},children:e.jsx(y,{text:"давні назви",onClick:()=>l(!0)})}),n.oldNames&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"newline",style:{flexDirection:"column",alignItems:"center",textAlign:"center",display:o?"flex":"none"},children:n.oldNames.map((t,i)=>e.jsx("div",{style:{textAlign:"center"},children:t},i))})})]}),n.description&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx(x,{data:n.description,style:{textAlign:"center"}})]}),n.architecture&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:e.jsxs("span",{children:["Архітектурний стиль: ",e.jsx(x,{data:n.architecture,style:{fontStyle:"italic"}})]})})]}),n.history&&e.jsx(F,{data:n.history})]})}):e.jsx(e.Fragment,{})}const J=({initialZoom:n,filters:r})=>{const[c,o]=u.useState(A(n)),l=B({zoomend(){o(A(l.getZoom()))}}),s=t=>{const i=l.getZoom();l.setView(t,i<18?18:i)};return e.jsxs(e.Fragment,{children:[b.filter(t=>!!t.coordinates&&!!t.periodOfDestruction&&(r.searchTerm?N(t,r):r.lost.find(i=>i===t.periodOfDestruction?.name))).map(t=>e.jsx(S,{children:e.jsx(G,{data:t,markerSize:c,onClick:()=>s(t.coordinates)})},t.coordinates?.toString())),I.filter(t=>!!t.coordinates&&(r.searchTerm?N(t,r):r.unknown&&!t.period||r.periods.find(i=>i===t.period?.name))).map(t=>e.jsx(S,{children:e.jsx(Q,{data:t,markerSize:c,onClick:()=>s(t.coordinates)})},t.coordinates?.toString())),r.monuments&&O.filter(t=>!!t.coordinates&&(!r.searchTerm||N(t,r))).map(t=>e.jsx(S,{children:e.jsx(Y,{data:t,markerSize:c,onClick:()=>s(t.coordinates)})},t.coordinates?.toString()))]})},v={darkStyle:"https://api.maptiler.com/maps/01994715-1d17-713b-ade5-bb3c25d2e329/style.json",lightStyle:"https://api.maptiler.com/maps/01994715-f124-7a6f-af6d-4f1e9a78ac9a/style.json",x:"Wjh0cnRiN1R6UkNYZE1TU2ZCQ3Q="},re=({theme:n,filters:r})=>{const c=g.latLngBounds([48.6184,24.9379],[48.4868,25.1415]),o=16,[l,s]=u.useState(null),[t,i]=u.useState(null),a=d=>{g.hash(d)};return u.useEffect(()=>{const d=n===H.Dark?v.darkStyle:v.lightStyle,h=atob(v.x),m=p=>{const j={apiKey:h,style:d},C=new z(j);return C.addTo(p),C};l&&(t?t.setStyle(d):(a(l),i(m(l))))},[l,t,n]),e.jsxs(P,{center:[48.525,25.0373],zoom:o,minZoom:14,zoomControl:!1,maxBoundsViscosity:.7,maxBounds:c,ref:s,children:[e.jsx(Z,{position:"topright"}),e.jsx(J,{initialZoom:o,filters:r})]})};export{re as default};
