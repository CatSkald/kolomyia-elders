import{j as e,m as b,a as D,b as I,c as O,d as j}from"./index-Cs8cHM40.js";import{b as u,C as T,P as k,M,l as C,u as B,F as S,c as P,Z,d as z}from"./mapping-B9r_meIv.js";import{c as f,d as U,e as W,i as A,T as H}from"./data-CUokAW2m.js";import{g as V}from"./maplibre-rKPIQzw8.js";import"./buildings-u542tLLX.js";const $=({header:n,children:r,expanded:o})=>{const[i,c]=u.useState(o??!1);return e.jsxs("div",{className:`collapsible${i?"":" collapsed"}`,children:[e.jsx("h2",{className:"collapsible-header",onClick:()=>c(!i),children:n}),e.jsx("div",{className:"collapsible-content",children:r})]})};var w,R;function L(){if(R)return w;R=1;var n=function(l){return l instanceof RegExp},r=function(s){var t=/[\\^$.*+?()[\]{}|]/g,a=RegExp(t.source);return s&&a.test(s)?s.replace(t,"\\$&"):s},o=function(l){return typeof l=="string"},i=function(l){var s=[];return l.forEach(function(t){Array.isArray(t)?s=s.concat(t):s.push(t)}),s};function c(l,s,t){var a=0,d=0;if(l==="")return l;if(!l||!o(l))throw new TypeError("First argument to react-string-replace#replaceString must be a string");var h=s;n(h)||(h=new RegExp("("+r(h)+")","gi"));for(var m=l.split(h),p=1,g=m.length;p<g;p+=2){if(m[p]===void 0||m[p-1]===void 0){console.warn("reactStringReplace: Encountered undefined value during string replacement. Your RegExp may not be working the way you expect.");continue}d=m[p].length,a+=m[p-1].length,m[p]=t(m[p],p,a),a+=d}return m}return w=function(s,t,a){return Array.isArray(s)||(s=[s]),i(s.map(function(d){return o(d)?c(d,t,a):d}))},w}var _=L();const q=V(_),x=({data:n,style:r})=>q(n,/([\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Connector_Punctuation}\p{Join_Control}]+\s?<\d+>)/gu,i=>{const[c,l]=i.replace(">","").split("<").map(t=>t.trim());console.log(i,c,l);const s=b.find(t=>t.id===l);return e.jsx("span",{style:r,...s?{className:"has-tooltip",title:s.definition}:{},children:c})}),E=({data:n})=>e.jsx("sup",{className:"has-tooltip",title:n.map(r=>r.title).join("; "),children:n.map(r=>r.number).join(",")}),F=({data:n})=>e.jsx($,{header:"Історія",children:e.jsx("ul",{children:n.map((r,o)=>e.jsxs("li",{children:[r.date&&e.jsx("span",{style:{fontWeight:"bold",fontStyle:"italic"},children:r.date}),r.date&&r.description&&" — ",e.jsxs("span",{style:{whiteSpace:"pre-wrap"},children:[e.jsx(x,{data:r.description}),r.sources&&e.jsx(E,{data:r.sources})]})]},o))})}),y=({text:n,onClick:r})=>e.jsx("sup",{role:"button","aria-label":n,onClick:r,style:{color:"var(--color-link)"},children:n});function Q({data:n,markerSize:r,onClick:o}){const[i,c]=u.useState(!1),[l,s]=u.useState(!1),t=n.period?.color??f.unknown;return n.coordinates?e.jsx(T,{center:n.coordinates,radius:r/2,color:f.overlay,opacity:.5,fillColor:t,fillOpacity:1,stroke:!0,weight:1,eventHandlers:{click:a=>{o(),a.target.openPopup(n.coordinates)}},children:e.jsxs(k,{className:"marker-popup",autoPan:!1,children:[e.jsxs("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:[e.jsx(x,{data:n.name,style:{fontWeight:"bold",fontSize:"1rem"}}),e.jsx("span",{style:{fontSize:"0.9rem"},children:n.date}),n.oldNames&&e.jsx("div",{style:i?{display:"none"}:{},children:e.jsx(y,{text:"давні назви",onClick:()=>c(!0)})}),n.oldNames&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"newline",style:{flexDirection:"column",alignItems:"center",textAlign:"center",display:i?"flex":"none"},children:n.oldNames.map((a,d)=>e.jsx("div",{style:{textAlign:"center"},children:a},d))}),e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}})]}),e.jsx("span",{style:{fontStyle:"italic"},children:n.address}),n.oldStreetNames&&e.jsx("div",{style:l?{display:"none"}:{},children:e.jsx(y,{text:"давні назви вулиці",onClick:()=>s(!0)})}),n.oldStreetNames&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"newline",style:{flexDirection:"column",alignItems:"center",textAlign:"center",display:l?"flex":"none"},children:n.oldStreetNames.map((a,d)=>e.jsx("div",{style:{textAlign:"center"},children:a},d))})})]}),n.description&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx(x,{data:n.description,style:{textAlign:"center"}})]}),n.architecture&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:e.jsxs("span",{children:["Архітектурний стиль: ",e.jsx(x,{data:n.architecture,style:{fontStyle:"italic"}})]})})]}),n.history&&e.jsx(F,{data:n.history})]})}):e.jsx(e.Fragment,{})}function Y({data:n,markerSize:r,onClick:o}){const[i,c]=u.useState(!1),l=n.period?.color??f.unknown;return n.coordinates?e.jsx(M,{position:n.coordinates,eventHandlers:{click:s=>{o(),s.target.openPopup(n.coordinates)}},icon:new C.DivIcon({className:"marker",iconSize:[r,r],iconAnchor:[r/2,r],html:U(r,l)}),children:e.jsxs(k,{className:"marker-popup",autoPan:!1,children:[e.jsxs("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:[e.jsx(x,{data:n.name,style:{fontWeight:"bold",fontSize:"1rem"}}),e.jsxs("span",{style:{fontSize:"0.9rem"},children:[n.date,n.destroyed?`—${n.destroyed}`:""]}),n.oldNames&&e.jsx("div",{style:i?{display:"none"}:{},children:e.jsx(y,{text:"давні назви",onClick:()=>c(!0)})}),n.oldNames&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"newline",style:{flexDirection:"column",alignItems:"center",textAlign:"center",display:i?"flex":"none"},children:n.oldNames.map((s,t)=>e.jsx("div",{style:{textAlign:"center"},children:s},t))})})]}),n.history&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsxs("div",{style:{whiteSpace:"pre-wrap"},children:[e.jsx(x,{data:n.history}),n.sources&&e.jsx(E,{data:n.sources})]})]})]})}):e.jsx(e.Fragment,{})}function N(n,r){if(!r.searchTerm)return!1;const o=r.searchTerm.toUpperCase();return Object.values(n).filter(i=>{if(typeof i=="string")return i.toUpperCase().includes(o);if(typeof i=="number")return i.toString().includes(o);if(Array.isArray(i))return i.filter(c=>typeof c=="string"?c.toUpperCase().includes(o):typeof c=="object"&&"description"in c?c.description.toUpperCase().includes(o):!1).length>0}).length>0}function G({data:n,markerSize:r,onClick:o}){const[i,c]=u.useState(!1),l=n.periodOfDestruction?.color??f.unknown;return n.coordinates?e.jsx(M,{position:n.coordinates,eventHandlers:{click:s=>{o(),s.target.openPopup(n.coordinates)}},icon:new C.DivIcon({className:"marker",iconSize:[r,r],iconAnchor:[r/2,r],html:W(r,l,!0)}),children:e.jsxs(k,{className:"marker-popup",autoPan:!1,children:[e.jsxs("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:[e.jsx(x,{data:n.name,style:{fontWeight:"bold",fontSize:"1rem"}}),e.jsxs("span",{style:{fontSize:"0.9rem"},children:[n.date,"—",n.destroyed]}),n.oldNames&&e.jsx("div",{style:i?{display:"none"}:{},children:e.jsx(y,{text:"давні назви",onClick:()=>c(!0)})}),n.oldNames&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"newline",style:{flexDirection:"column",alignItems:"center",textAlign:"center",display:i?"flex":"none"},children:n.oldNames.map((s,t)=>e.jsx("div",{style:{textAlign:"center"},children:s},t))})})]}),n.description&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx(x,{data:n.description,style:{textAlign:"center"}})]}),n.architecture&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:e.jsxs("span",{children:["Архітектурний стиль: ",e.jsx(x,{data:n.architecture,style:{fontStyle:"italic"}})]})})]}),n.history&&e.jsx(F,{data:n.history})]})}):e.jsx(e.Fragment,{})}const J=({initialZoom:n,onZoom:r,filters:o})=>{const[i,c]=u.useState(A(n)),l=B({zoomend(){const t=l.getZoom();c(A(t)),r(t)}}),s=t=>{const a=l.getZoom();l.setView(t,a<18?18:a)};return e.jsxs(e.Fragment,{children:[D.filter(t=>!!t.coordinates&&!!t.periodOfDestruction&&(o.searchTerm?N(t,o):o.lost.find(a=>a===t.periodOfDestruction?.name))).map(t=>e.jsx(S,{children:e.jsx(G,{data:t,markerSize:i,onClick:()=>s(t.coordinates)})},t.coordinates?.toString())),I.filter(t=>!!t.coordinates&&(o.searchTerm?N(t,o):o.unknown&&!t.period||o.periods.find(a=>a===t.period?.name))).map(t=>e.jsx(S,{children:e.jsx(Q,{data:t,markerSize:i,onClick:()=>s(t.coordinates)})},t.coordinates?.toString())),o.monuments&&O.filter(t=>!!t.coordinates&&(!o.searchTerm||N(t,o))).map(t=>e.jsx(S,{children:e.jsx(Y,{data:t,markerSize:i,onClick:()=>s(t.coordinates)})},t.coordinates?.toString()))]})},v={darkStyle:"https://api.maptiler.com/maps/01994715-1d17-713b-ade5-bb3c25d2e329/style.json",lightStyle:"https://api.maptiler.com/maps/01994715-f124-7a6f-af6d-4f1e9a78ac9a/style.json",x:"Wjh0cnRiN1R6UkNYZE1TU2ZCQ3Q="},K=atob(v.x),se=({theme:n,filters:r,mapSettings:o,onZoom:i})=>{const[c,l]=u.useState(null),[s,t]=u.useState(null),a=d=>{C.hash(d)};return u.useEffect(()=>{const d=n===H.Dark?v.darkStyle:v.lightStyle,h=m=>{const p={apiKey:K,style:d},g=new z(p);return g.addTo(m),g};c&&(s?s.setStyle(d):(a(c),t(h(c))))},[c,s,n]),e.jsxs(P,{center:o.center,zoom:o.zoom,minZoom:j.minZoom,maxZoom:j.maxZoom,zoomControl:!1,maxBoundsViscosity:.7,maxBounds:j.bounds,ref:l,children:[e.jsx(Z,{position:"topright"}),e.jsx(J,{initialZoom:o.zoom,onZoom:i,filters:r})]})};export{se as default};
