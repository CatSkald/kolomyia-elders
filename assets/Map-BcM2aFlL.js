import{j as e,m as D,a as I,b as O,c as T,d as j}from"./index-D4n5kemn.js";import{b as x,C as B,P as k,M as E,l as C,u as P,F as S,c as Z,Z as z,d as U}from"./mapping-B9r_meIv.js";import{c as g,d as W,e as H,i as R,T as V}from"./data-CUokAW2m.js";import{g as $}from"./maplibre-rKPIQzw8.js";import"./buildings-u542tLLX.js";const L=({header:n,children:r,expanded:o})=>{const[c,a]=x.useState(o??!1);return e.jsxs("div",{className:`collapsible${c?"":" collapsed"}`,children:[e.jsx("h2",{className:"collapsible-header",onClick:()=>a(!c),children:n}),e.jsx("div",{className:"collapsible-content",children:r})]})};var w,M;function _(){if(M)return w;M=1;var n=function(i){return i instanceof RegExp},r=function(s){var l=/[\\^$.*+?()[\]{}|]/g,t=RegExp(l.source);return s&&t.test(s)?s.replace(l,"\\$&"):s},o=function(i){return typeof i=="string"},c=function(i){var s=[];return i.forEach(function(l){Array.isArray(l)?s=s.concat(l):s.push(l)}),s};function a(i,s,l){var t=0,d=0;if(i==="")return i;if(!i||!o(i))throw new TypeError("First argument to react-string-replace#replaceString must be a string");var u=s;n(u)||(u=new RegExp("("+r(u)+")","gi"));for(var m=i.split(u),p=1,y=m.length;p<y;p+=2){if(m[p]===void 0||m[p-1]===void 0){console.warn("reactStringReplace: Encountered undefined value during string replacement. Your RegExp may not be working the way you expect.");continue}d=m[p].length,t+=m[p-1].length,m[p]=l(m[p],p,t),t+=d}return m}return w=function(s,l,t){return Array.isArray(s)||(s=[s]),c(s.map(function(d){return o(d)?a(d,l,t):d}))},w}var q=_();const Q=$(q),h=({data:n,style:r})=>Q(n,/([\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Connector_Punctuation}\p{Join_Control}]+\s?<\d+>)/gu,c=>{const[a,i]=c.replace(">","").split("<").map(l=>l.trim());console.log(c,a,i);const s=D.find(l=>l.id===i);return e.jsx("span",{style:r,...s?{className:"has-tooltip",title:s.definition}:{},children:a})}),F=({data:n})=>e.jsx("sup",{className:"has-tooltip",title:n.map(r=>r.title).join("; "),children:n.map(r=>r.number).join(",")}),b=({data:n})=>e.jsx(L,{header:"Історія",children:e.jsx("ul",{children:n.map((r,o)=>e.jsxs("li",{children:[r.date&&e.jsx("span",{style:{fontWeight:"bold",fontStyle:"italic"},children:r.date}),r.date&&r.description&&" — ",e.jsxs("span",{style:{whiteSpace:"pre-wrap"},children:[e.jsx(h,{data:r.description}),r.sources&&e.jsx(F,{data:r.sources})]})]},o))})}),f=({text:n,onClick:r})=>e.jsx("sup",{role:"button","aria-label":n,onClick:r,style:{color:"var(--color-link)"},children:n});function Y({data:n,markerSize:r,onClick:o}){const[c,a]=x.useState(!1),[i,s]=x.useState(!1),l=n.period?.color??g.unknown;return n.coordinates?e.jsx(B,{center:n.coordinates,radius:r/2,color:g.overlay,opacity:.5,fillColor:l,fillOpacity:1,stroke:!0,weight:1,eventHandlers:{click:t=>{o(),t.target.openPopup(n.coordinates)}},children:e.jsxs(k,{className:"marker-popup",autoPan:!1,children:[e.jsxs("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:[e.jsx(h,{data:n.name,style:{fontWeight:"bold",fontSize:"1rem"}}),e.jsx("span",{style:{fontSize:"0.9rem"},children:n.date}),n.oldNames&&e.jsx("div",{style:c?{display:"none"}:{},children:e.jsx(f,{text:"давні назви",onClick:()=>a(!0)})}),n.oldNames&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"newline",style:{flexDirection:"column",alignItems:"center",textAlign:"center",display:c?"flex":"none"},children:n.oldNames.map((t,d)=>e.jsx("div",{style:{textAlign:"center"},children:t},d))}),e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}})]}),e.jsx("span",{style:{fontStyle:"italic"},children:n.address}),n.oldStreetNames&&e.jsx("div",{style:i?{display:"none"}:{},children:e.jsx(f,{text:"давні назви вулиці",onClick:()=>s(!0)})}),n.oldStreetNames&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"newline",style:{flexDirection:"column",alignItems:"center",textAlign:"center",display:i?"flex":"none"},children:n.oldStreetNames.map((t,d)=>e.jsx("div",{style:{textAlign:"center"},children:t},d))})})]}),n.description&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx(h,{data:n.description,style:{textAlign:"center"}})]}),n.architecture&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:e.jsxs("span",{children:["Архітектурний стиль: ",e.jsx(h,{data:n.architecture,style:{fontStyle:"italic"}})]})})]}),n.history&&e.jsx(b,{data:n.history})]})}):e.jsx(e.Fragment,{})}function G({data:n,markerSize:r,onClick:o}){const[c,a]=x.useState(!1),i=n.period?.color??g.unknown;return n.coordinates?e.jsx(E,{position:n.coordinates,eventHandlers:{click:s=>{o(),s.target.openPopup(n.coordinates)}},icon:new C.DivIcon({className:"marker",iconSize:[r,r],iconAnchor:[r/2,r],html:W(r,i)}),children:e.jsxs(k,{className:"marker-popup",autoPan:!1,children:[e.jsxs("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:[e.jsx(h,{data:n.name,style:{fontWeight:"bold",fontSize:"1rem"}}),e.jsxs("span",{style:{fontSize:"0.9rem"},children:[n.date,n.destroyed?`—${n.destroyed}`:""]}),n.oldNames&&e.jsx("div",{style:c?{display:"none"}:{},children:e.jsx(f,{text:"давні назви",onClick:()=>a(!0)})}),n.oldNames&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"newline",style:{flexDirection:"column",alignItems:"center",textAlign:"center",display:c?"flex":"none"},children:n.oldNames.map((s,l)=>e.jsx("div",{style:{textAlign:"center"},children:s},l))})})]}),n.history&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsxs("div",{style:{whiteSpace:"pre-wrap"},children:[e.jsx(h,{data:n.history}),n.sources&&e.jsx(F,{data:n.sources})]})]})]})}):e.jsx(e.Fragment,{})}function N(n,r){if(!r.searchTerm)return!1;const o=r.searchTerm.toUpperCase();return Object.values(n).filter(c=>{if(typeof c=="string")return c.toUpperCase().includes(o);if(typeof c=="number")return c.toString().includes(o);if(Array.isArray(c))return c.filter(a=>typeof a=="string"?a.toUpperCase().includes(o):typeof a=="object"&&"description"in a?a.description.toUpperCase().includes(o):!1).length>0}).length>0}function J({data:n,markerSize:r,onClick:o}){const[c,a]=x.useState(!1),i=n.periodOfDestruction?.color??g.unknown;return n.coordinates?e.jsx(E,{position:n.coordinates,eventHandlers:{click:s=>{o(),s.target.openPopup(n.coordinates)}},icon:new C.DivIcon({className:"marker",iconSize:[r,r],iconAnchor:[r/2,r],html:H(r,i,!0)}),children:e.jsxs(k,{className:"marker-popup",autoPan:!1,children:[e.jsxs("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:[e.jsx(h,{data:n.name,style:{fontWeight:"bold",fontSize:"1rem"}}),e.jsxs("span",{style:{fontSize:"0.9rem"},children:[n.date,"—",n.destroyed]}),n.oldNames&&e.jsx("div",{style:c?{display:"none"}:{},children:e.jsx(f,{text:"давні назви",onClick:()=>a(!0)})}),n.oldNames&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"newline",style:{flexDirection:"column",alignItems:"center",textAlign:"center",display:c?"flex":"none"},children:n.oldNames.map((s,l)=>e.jsx("div",{style:{textAlign:"center"},children:s},l))})})]}),n.description&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx(h,{data:n.description,style:{textAlign:"center"}})]}),n.architecture&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:e.jsxs("span",{children:["Архітектурний стиль: ",e.jsx(h,{data:n.architecture,style:{fontStyle:"italic"}})]})})]}),n.history&&e.jsx(b,{data:n.history})]})}):e.jsx(e.Fragment,{})}const K=({initialZoom:n,onZoom:r,filters:o,onMarkerSelected:c})=>{const[a,i]=x.useState(R(n)),s=P({zoomend(){const t=s.getZoom();i(R(t)),r(t)}}),l=t=>{const d=s.getZoom();s.setView(t,d<18?18:d),c(t)};return e.jsxs(e.Fragment,{children:[I.filter(t=>!!t.coordinates&&!!t.periodOfDestruction&&(o.searchTerm?N(t,o):o.lost.find(d=>d===t.periodOfDestruction?.name))).map(t=>e.jsx(S,{children:e.jsx(J,{data:t,markerSize:a,onClick:()=>l(t.coordinates)})},t.coordinates?.toString())),O.filter(t=>!!t.coordinates&&(o.searchTerm?N(t,o):o.unknown&&!t.period||o.periods.find(d=>d===t.period?.name))).map(t=>e.jsx(S,{children:e.jsx(Y,{data:t,markerSize:a,onClick:()=>l(t.coordinates)})},t.coordinates?.toString())),o.monuments&&T.filter(t=>!!t.coordinates&&(!o.searchTerm||N(t,o))).map(t=>e.jsx(S,{children:e.jsx(G,{data:t,markerSize:a,onClick:()=>l(t.coordinates)})},t.coordinates?.toString()))]})},v={darkStyle:"https://api.maptiler.com/maps/01994715-1d17-713b-ade5-bb3c25d2e329/style.json",lightStyle:"https://api.maptiler.com/maps/01994715-f124-7a6f-af6d-4f1e9a78ac9a/style.json",x:"Wjh0cnRiN1R6UkNYZE1TU2ZCQ3Q="},X=atob(v.x),oe=({theme:n,filters:r,mapSettings:o,onZoom:c,onMarkerSelected:a})=>{const[i,s]=x.useState(null),[l,t]=x.useState(null),d=u=>{C.hash(u)};return x.useEffect(()=>{const u=n===V.Dark?v.darkStyle:v.lightStyle,m=p=>{const y={apiKey:X,style:u},A=new U(y);return A.addTo(p),A};i&&(l?l.setStyle(u):(d(i),t(m(i))))},[i,l,n]),e.jsxs(Z,{center:o.center,zoom:o.zoom,minZoom:j.minZoom,maxZoom:j.maxZoom,zoomControl:!1,maxBoundsViscosity:.7,maxBounds:j.bounds,ref:s,children:[e.jsx(z,{position:"topright"}),e.jsx(K,{initialZoom:o.zoom,onZoom:c,filters:r,onMarkerSelected:a})]})};export{oe as default};
