import{j as e,m as F,a as D,b as I,c as O,d as T,e as S}from"./index-CWoRJmda.js";import{b as h,C as B,P as C,M as b,l as A,u as Z,F as N,c as z,Z as P,d as U}from"./mapping-UXJfvW6R.js";import{c as y,d as W,e as $,i as R,T as H}from"./data-CtJ01c-t.js";import{g as L}from"./maplibre-C8z7rIVu.js";import"./buildings-Dxvfrhr-.js";const V=({header:n,children:t,expanded:s})=>{const[a,c]=h.useState(s??!1);return e.jsxs("div",{className:`collapsible${a?"":" collapsed"}`,children:[e.jsx("h2",{className:"collapsible-header",onClick:()=>c(!a),children:n}),e.jsx("div",{className:"collapsible-content",children:t})]})};var w,M;function _(){if(M)return w;M=1;var n=function(l){return l instanceof RegExp},t=function(i){var o=/[\\^$.*+?()[\]{}|]/g,r=RegExp(o.source);return i&&r.test(i)?i.replace(o,"\\$&"):i},s=function(l){return typeof l=="string"},a=function(l){var i=[];return l.forEach(function(o){Array.isArray(o)?i=i.concat(o):i.push(o)}),i};function c(l,i,o,r=null){var d=0,p=0;if(l==="")return l;if(!l||!s(l))throw new TypeError("First argument to react-string-replace#replaceString must be a string");var m=i;n(m)||(m=new RegExp("("+t(m)+")","gi"));for(var u=l.split(m),x=1,f=u.length;x<f&&!(Number.isInteger(r)&&(r*2<x||r<1));x+=2){if(u[x]===void 0||u[x-1]===void 0){console.warn("reactStringReplace: Encountered undefined value during string replacement. Your RegExp may not be working the way you expect.");continue}p=u[x].length,d+=u[x-1].length,u[x]=o(u[x],(x-1)/2,d),d+=p}return u}return w=function(i,o,r,d=null){return Array.isArray(i)||(i=[i]),a(i.map(function(p){var m;if(s(p))if(Number.isInteger(d)&&d>0){m=c(p,o,r,d);var u=n(o)?o:new RegExp("("+t(o)+")","gi");d-=(p.match(u)||[]).length}else m=c(p,o,r,d);else m=p;return m}))},w}var q=_();const Q=L(q),Y=({data:n})=>e.jsx("sup",{className:"has-tooltip",style:{display:"inline"},title:n.map(t=>t.title).join("; "),children:n.map(t=>t.number).join(",")}),g=({data:n,style:t})=>{const{sourcedText:s,sources:a}=G(n),c=a?s:n,l=/([\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Connector_Punctuation}\p{Join_Control}]+\s?<\d+>)/gu;return e.jsxs("span",{children:[e.jsx("span",{style:t,children:Q(c,l,(i,o)=>{const[r,d]=i.replace(">","").split("<").map(m=>m.trim()),p=F.find(m=>m.id===d);return e.jsx("span",{...p?{className:"has-tooltip",title:p.definition}:{},children:r},o)})}),a&&e.jsx(Y,{data:a})]})},G=n=>{const s=n.indexOf("[")!==-1;let a,c;if(s){const l=n.split("[");c=l[0].trim(),a=l[1].slice(0,-1).split(",").map(i=>{const o=Number(i);return D.find(r=>r.number===o)??{number:o,title:`Джерело №${o}`}})}return{sourcedText:c,sources:a}},E=({data:n})=>e.jsx(V,{header:"Історія",children:e.jsx("ul",{children:n.map((t,s)=>e.jsxs("li",{children:[t.date&&e.jsx("span",{style:{fontWeight:"bold",fontStyle:"italic"},children:t.date}),t.date&&t.description&&" — ",e.jsx(g,{data:t.description})]},s))})}),j=({text:n,onClick:t})=>e.jsx("sup",{role:"button","aria-label":n,onClick:t,style:{color:"var(--color-link)"},children:n});function J({data:n,markerSize:t,onClick:s}){const[a,c]=h.useState(!1),[l,i]=h.useState(!1),o=n.period?.color??y.unknown;return n.coordinates?e.jsx(B,{center:n.coordinates,radius:t/2,color:y.overlay,opacity:.5,fillColor:o,fillOpacity:1,stroke:!0,weight:1,eventHandlers:{click:r=>{s(),r.target.openPopup(n.coordinates)}},children:e.jsxs(C,{className:"marker-popup",autoPan:!1,children:[e.jsxs("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:[e.jsx(g,{data:n.name,style:{fontWeight:"bold",fontSize:"1rem"}}),e.jsx("span",{style:{fontSize:"0.9rem"},children:n.date}),n.oldNames&&e.jsx("div",{style:a?{display:"none"}:{},children:e.jsx(j,{text:"давні назви",onClick:()=>c(!0)})}),n.oldNames&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"newline",style:{flexDirection:"column",alignItems:"center",textAlign:"center",display:a?"flex":"none"},children:n.oldNames.map((r,d)=>e.jsx("div",{style:{textAlign:"center"},children:r},d))}),e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}})]}),e.jsx("span",{style:{fontStyle:"italic"},children:n.address}),n.oldStreetNames&&e.jsx("div",{style:l?{display:"none"}:{},children:e.jsx(j,{text:"давні назви вулиці",onClick:()=>i(!0)})}),n.oldStreetNames&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"newline",style:{flexDirection:"column",alignItems:"center",textAlign:"center",display:l?"flex":"none"},children:n.oldStreetNames.map((r,d)=>e.jsx("div",{style:{textAlign:"center"},children:r},d))})})]}),n.description&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx(g,{data:n.description,style:{textAlign:"center"}})]}),n.architecture&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:e.jsxs("span",{children:["Архітектурний стиль: ",e.jsx(g,{data:n.architecture,style:{fontStyle:"italic"}})]})})]}),n.history&&e.jsx(E,{data:n.history})]})}):e.jsx(e.Fragment,{})}function K({data:n,markerSize:t,onClick:s}){const[a,c]=h.useState(!1),l=n.period?.color??y.unknown;return n.coordinates?e.jsx(b,{position:n.coordinates,eventHandlers:{click:i=>{s(),i.target.openPopup(n.coordinates)}},icon:new A.DivIcon({className:"marker",iconSize:[t,t],iconAnchor:[t/2,t],html:W(t,l)}),children:e.jsxs(C,{className:"marker-popup",autoPan:!1,children:[e.jsxs("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:[e.jsx(g,{data:n.name,style:{fontWeight:"bold",fontSize:"1rem"}}),e.jsxs("span",{style:{fontSize:"0.9rem"},children:[n.date,n.destroyed?`—${n.destroyed}`:""]}),n.oldNames&&e.jsx("div",{style:a?{display:"none"}:{},children:e.jsx(j,{text:"давні назви",onClick:()=>c(!0)})}),n.oldNames&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"newline",style:{flexDirection:"column",alignItems:"center",textAlign:"center",display:a?"flex":"none"},children:n.oldNames.map((i,o)=>e.jsx("div",{style:{textAlign:"center"},children:i},o))})})]}),n.history&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx(g,{data:n.history})]})]})}):e.jsx(e.Fragment,{})}function v(n,t){if(!t.searchTerm)return!1;const s=t.searchTerm.toUpperCase();return Object.values(n).filter(a=>{if(typeof a=="string")return a.toUpperCase().includes(s);if(typeof a=="number")return a.toString().includes(s);if(Array.isArray(a))return a.filter(c=>typeof c=="string"?c.toUpperCase().includes(s):typeof c=="object"&&"description"in c?c.description.toUpperCase().includes(s):!1).length>0}).length>0}function X({data:n,markerSize:t,onClick:s}){const[a,c]=h.useState(!1),l=n.periodOfDestruction?.color??y.unknown;return n.coordinates?e.jsx(b,{position:n.coordinates,eventHandlers:{click:i=>{s(),i.target.openPopup(n.coordinates)}},icon:new A.DivIcon({className:"marker",iconSize:[t,t],iconAnchor:[t/2,t],html:$(t,l,!0)}),children:e.jsxs(C,{className:"marker-popup",autoPan:!1,children:[e.jsxs("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:[e.jsx(g,{data:n.name,style:{fontWeight:"bold",fontSize:"1rem"}}),e.jsxs("span",{style:{fontSize:"0.9rem"},children:[n.date,"—",n.destroyed]}),n.oldNames&&e.jsx("div",{style:a?{display:"none"}:{},children:e.jsx(j,{text:"давні назви",onClick:()=>c(!0)})}),n.oldNames&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"newline",style:{flexDirection:"column",alignItems:"center",textAlign:"center",display:a?"flex":"none"},children:n.oldNames.map((i,o)=>e.jsx("div",{style:{textAlign:"center"},children:i},o))})})]}),n.description&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx(g,{data:n.description,style:{textAlign:"center"}})]}),n.architecture&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:e.jsxs("span",{children:["Архітектурний стиль: ",e.jsx(g,{data:n.architecture,style:{fontStyle:"italic"}})]})})]}),n.history&&e.jsx(E,{data:n.history})]})}):e.jsx(e.Fragment,{})}const ee=({initialZoom:n,onZoom:t,filters:s,onMarkerSelected:a})=>{const[c,l]=h.useState(R(n)),i=Z({zoomend(){const r=i.getZoom();l(R(r)),t(r)}}),o=r=>{const d=i.getZoom();i.setView(r,d<18?18:d),a(r)};return e.jsxs(e.Fragment,{children:[I.filter(r=>!!r.coordinates&&!!r.periodOfDestruction&&(s.searchTerm?v(r,s):s.lost.find(d=>d===r.periodOfDestruction?.name))).map(r=>e.jsx(N,{children:e.jsx(X,{data:r,markerSize:c,onClick:()=>o(r.coordinates)})},r.coordinates?.toString())),O.filter(r=>!!r.coordinates&&(s.searchTerm?v(r,s):s.unknown&&!r.period||s.periods.find(d=>d===r.period?.name))).map(r=>e.jsx(N,{children:e.jsx(J,{data:r,markerSize:c,onClick:()=>o(r.coordinates)})},r.coordinates?.toString())),s.monuments&&T.filter(r=>!!r.coordinates&&(!s.searchTerm||v(r,s))).map(r=>e.jsx(N,{children:e.jsx(K,{data:r,markerSize:c,onClick:()=>o(r.coordinates)})},r.coordinates?.toString()))]})},k={darkStyle:"https://api.maptiler.com/maps/01994715-1d17-713b-ade5-bb3c25d2e329/style.json",lightStyle:"https://api.maptiler.com/maps/01994715-f124-7a6f-af6d-4f1e9a78ac9a/style.json",x:"Wjh0cnRiN1R6UkNYZE1TU2ZCQ3Q="},ne=atob(k.x),le=({theme:n,filters:t,mapSettings:s,onZoom:a,onMarkerSelected:c})=>{const[l,i]=h.useState(null),[o,r]=h.useState(null),d=p=>{A.hash(p)};return h.useEffect(()=>{const p=n===H.Dark?k.darkStyle:k.lightStyle,m=u=>{const x={apiKey:ne,style:p},f=new U(x);return f.addTo(u),f};l&&(o?o.setStyle(p):(d(l),r(m(l))))},[l,o,n]),e.jsxs(z,{center:s.center,zoom:s.zoom,minZoom:S.minZoom,maxZoom:S.maxZoom,zoomControl:!1,maxBoundsViscosity:.7,maxBounds:S.bounds,ref:i,children:[e.jsx(P,{position:"topright"}),e.jsx(ee,{initialZoom:s.zoom,onZoom:a,filters:t,onMarkerSelected:c})]})};export{le as default};
