import{j as e,m as F,a as D,b,c as I}from"./index-PDLWVKeo.js";import{b as u,C as O,P as k,M as R,l as f,u as T,F as S,c as B,Z as P,d as Z}from"./mapping-B9r_meIv.js";import{c as y,d as z,e as U,i as C,T as W}from"./data-BRLygxHr.js";import{g as H}from"./maplibre-rKPIQzw8.js";import"./buildings-DfDJztbw.js";const L=({header:n,children:r,expanded:c})=>{const[o,l]=u.useState(c??!1);return e.jsxs("div",{className:`collapsible${o?"":" collapsed"}`,children:[e.jsx("h2",{className:"collapsible-header",onClick:()=>l(!o),children:n}),e.jsx("div",{className:"collapsible-content",children:r})]})};var w,A;function V(){if(A)return w;A=1;var n=function(s){return s instanceof RegExp},r=function(t){var i=/[\\^$.*+?()[\]{}|]/g,a=RegExp(i.source);return t&&a.test(t)?t.replace(i,"\\$&"):t},c=function(s){return typeof s=="string"},o=function(s){var t=[];return s.forEach(function(i){Array.isArray(i)?t=t.concat(i):t.push(i)}),t};function l(s,t,i){var a=0,d=0;if(s==="")return s;if(!s||!c(s))throw new TypeError("First argument to react-string-replace#replaceString must be a string");var h=t;n(h)||(h=new RegExp("("+r(h)+")","gi"));for(var m=s.split(h),p=1,g=m.length;p<g;p+=2){if(m[p]===void 0||m[p-1]===void 0){console.warn("reactStringReplace: Encountered undefined value during string replacement. Your RegExp may not be working the way you expect.");continue}d=m[p].length,a+=m[p-1].length,m[p]=i(m[p],p,a),a+=d}return m}return w=function(t,i,a){return Array.isArray(t)||(t=[t]),o(t.map(function(d){return c(d)?l(d,i,a):d}))},w}var $=V();const _=H($),x=({data:n,style:r})=>_(n,/([\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Connector_Punctuation}\p{Join_Control}]+\s?<\d+>)/gu,o=>{const[l,s]=o.replace(">","").split("<").map(i=>i.trim());console.log(o,l,s);const t=F.find(i=>i.id===s);return e.jsx("span",{style:r,...t?{className:"has-tooltip",title:t.definition}:{},children:l})}),M=({data:n})=>e.jsx("sup",{className:"has-tooltip",title:n.map(r=>r.title).join("; "),children:n.map(r=>r.number).join(",")}),E=({data:n})=>e.jsx(L,{header:"Історія",children:e.jsx("ul",{children:n.map((r,c)=>e.jsxs("li",{children:[r.date&&e.jsx("span",{style:{fontWeight:"bold",fontStyle:"italic"},children:r.date}),r.date&&r.description&&" — ",e.jsxs("span",{style:{whiteSpace:"pre-wrap"},children:[e.jsx(x,{data:r.description}),r.sources&&e.jsx(M,{data:r.sources})]})]},c))})}),j=({text:n,onClick:r})=>e.jsx("sup",{role:"button","aria-label":n,onClick:r,style:{color:"var(--color-link)"},children:n});function q({data:n,markerSize:r,onClick:c}){const[o,l]=u.useState(!1),[s,t]=u.useState(!1),i=n.period?.color??y.unknown;return n.coordinates?e.jsx(O,{center:n.coordinates,radius:r/2,color:y.overlay,opacity:.5,fillColor:i,fillOpacity:1,stroke:!0,weight:1,eventHandlers:{click:a=>{c(),a.target.openPopup(n.coordinates)}},children:e.jsxs(k,{className:"marker-popup",autoPan:!1,children:[e.jsxs("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:[e.jsx(x,{data:n.name,style:{fontWeight:"bold",fontSize:"1rem"}}),e.jsx("span",{style:{fontSize:"0.9rem"},children:n.date}),n.oldNames&&e.jsx("div",{style:o?{display:"none"}:{},children:e.jsx(j,{text:"давні назви",onClick:()=>l(!0)})}),n.oldNames&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"newline",style:{flexDirection:"column",alignItems:"center",textAlign:"center",display:o?"flex":"none"},children:n.oldNames.map((a,d)=>e.jsx("div",{style:{textAlign:"center"},children:a},d))}),e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}})]}),e.jsx("span",{style:{fontStyle:"italic"},children:n.address}),n.oldStreetNames&&e.jsx("div",{style:s?{display:"none"}:{},children:e.jsx(j,{text:"давні назви вулиці",onClick:()=>t(!0)})}),n.oldStreetNames&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"newline",style:{flexDirection:"column",alignItems:"center",textAlign:"center",display:s?"flex":"none"},children:n.oldStreetNames.map((a,d)=>e.jsx("div",{style:{textAlign:"center"},children:a},d))})})]}),n.description&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx(x,{data:n.description,style:{textAlign:"center"}})]}),n.architecture&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:e.jsxs("span",{children:["Архітектурний стиль: ",e.jsx(x,{data:n.architecture,style:{fontStyle:"italic"}})]})})]}),n.history&&e.jsx(E,{data:n.history})]})}):e.jsx(e.Fragment,{})}function Q({data:n,markerSize:r,onClick:c}){const[o,l]=u.useState(!1),s=n.period?.color??y.unknown;return n.coordinates?e.jsx(R,{position:n.coordinates,eventHandlers:{click:t=>{c(),t.target.openPopup(n.coordinates)}},icon:new f.DivIcon({className:"marker",iconSize:[r,r],iconAnchor:[r/2,r],html:z(r,s)}),children:e.jsxs(k,{className:"marker-popup",autoPan:!1,children:[e.jsxs("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:[e.jsx(x,{data:n.name,style:{fontWeight:"bold",fontSize:"1rem"}}),e.jsxs("span",{style:{fontSize:"0.9rem"},children:[n.date,n.destroyed?`—${n.destroyed}`:""]}),n.oldNames&&e.jsx("div",{style:o?{display:"none"}:{},children:e.jsx(j,{text:"давні назви",onClick:()=>l(!0)})}),n.oldNames&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"newline",style:{flexDirection:"column",alignItems:"center",textAlign:"center",display:o?"flex":"none"},children:n.oldNames.map((t,i)=>e.jsx("div",{style:{textAlign:"center"},children:t},i))})})]}),n.history&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsxs("div",{style:{whiteSpace:"pre-wrap"},children:[e.jsx(x,{data:n.history}),n.sources&&e.jsx(M,{data:n.sources})]})]})]})}):e.jsx(e.Fragment,{})}function N(n,r){if(!r.searchTerm)return!1;const c=r.searchTerm.toUpperCase();return Object.values(n).filter(o=>{if(typeof o=="string")return o.toUpperCase().includes(c);if(typeof o=="number")return o.toString().includes(c);if(Array.isArray(o))return o.filter(l=>typeof l=="string"?l.toUpperCase().includes(c):typeof l=="object"&&"description"in l?l.description.toUpperCase().includes(c):!1).length>0}).length>0}function Y({data:n,markerSize:r,onClick:c}){const[o,l]=u.useState(!1),s=n.periodOfDestruction?.color??y.unknown;return n.coordinates?e.jsx(R,{position:n.coordinates,eventHandlers:{click:t=>{c(),t.target.openPopup(n.coordinates)}},icon:new f.DivIcon({className:"marker",iconSize:[r,r],iconAnchor:[r/2,r],html:U(r,s,!0)}),children:e.jsxs(k,{className:"marker-popup",autoPan:!1,children:[e.jsxs("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:[e.jsx(x,{data:n.name,style:{fontWeight:"bold",fontSize:"1rem"}}),e.jsxs("span",{style:{fontSize:"0.9rem"},children:[n.date,"—",n.destroyed]}),n.oldNames&&e.jsx("div",{style:o?{display:"none"}:{},children:e.jsx(j,{text:"давні назви",onClick:()=>l(!0)})}),n.oldNames&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"newline",style:{flexDirection:"column",alignItems:"center",textAlign:"center",display:o?"flex":"none"},children:n.oldNames.map((t,i)=>e.jsx("div",{style:{textAlign:"center"},children:t},i))})})]}),n.description&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx(x,{data:n.description,style:{textAlign:"center"}})]}),n.architecture&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",width:"100%"}}),e.jsx("div",{className:"newline",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:e.jsxs("span",{children:["Архітектурний стиль: ",e.jsx(x,{data:n.architecture,style:{fontStyle:"italic"}})]})})]}),n.history&&e.jsx(E,{data:n.history})]})}):e.jsx(e.Fragment,{})}const G=({initialZoom:n,filters:r})=>{const[c,o]=u.useState(C(n)),l=T({zoomend(){o(C(l.getZoom()))}}),s=t=>{const i=l.getZoom();l.setView(t,i<18?18:i)};return e.jsxs(e.Fragment,{children:[D.filter(t=>!!t.coordinates&&!!t.periodOfDestruction&&(r.searchTerm?N(t,r):r.lost.find(i=>i===t.periodOfDestruction?.name))).map(t=>e.jsx(S,{children:e.jsx(Y,{data:t,markerSize:c,onClick:()=>s(t.coordinates)})},t.coordinates?.toString())),b.filter(t=>!!t.coordinates&&(r.searchTerm?N(t,r):r.unknown&&!t.period||r.periods.find(i=>i===t.period?.name))).map(t=>e.jsx(S,{children:e.jsx(q,{data:t,markerSize:c,onClick:()=>s(t.coordinates)})},t.coordinates?.toString())),r.monuments&&I.filter(t=>!!t.coordinates&&(!r.searchTerm||N(t,r))).map(t=>e.jsx(S,{children:e.jsx(Q,{data:t,markerSize:c,onClick:()=>s(t.coordinates)})},t.coordinates?.toString()))]})},v={darkStyle:"https://api.maptiler.com/maps/01994715-1d17-713b-ade5-bb3c25d2e329/style.json",lightStyle:"https://api.maptiler.com/maps/01994715-f124-7a6f-af6d-4f1e9a78ac9a/style.json",x:"Wjh0cnRiN1R6UkNYZE1TU2ZCQ3Q="},J=atob(v.x),re=({theme:n,filters:r})=>{const c=f.latLngBounds([48.6184,24.9379],[48.4868,25.1415]),o=16,[l,s]=u.useState(null),[t,i]=u.useState(null),a=d=>{f.hash(d)};return u.useEffect(()=>{const d=n===W.Dark?v.darkStyle:v.lightStyle,h=m=>{const p={apiKey:J,style:d},g=new Z(p);return g.addTo(m),g};l&&(t?t.setStyle(d):(a(l),i(h(l))))},[l,t,n]),e.jsxs(B,{center:[48.525,25.0373],zoom:o,minZoom:14,zoomControl:!1,maxBoundsViscosity:.7,maxBounds:c,ref:s,children:[e.jsx(P,{position:"topright"}),e.jsx(G,{initialZoom:o,filters:r})]})};export{re as default};
